
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>phylotastic_services.resolve_names &#8212; Phylotastic-services 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for phylotastic_services.resolve_names</h1><div class="highlight"><pre>
<span></span><span class="c1">#resolver service: version 0.1</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">datetime</span>


<span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://resolver.globalnames.org/name_resolvers.json?&quot;</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;content-type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;http://phylo.cs.nmsu.edu:5004/phylotastic_ws/tnrs/&quot;</span>

<span class="c1">#~~~~~~~~~~~~~~~~~~~~ (GlobalNamesResolver-TNRS)~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="c1">#resolve scientific names</span>
<span class="k">def</span> <span class="nf">resolve_sn_gnr</span><span class="p">(</span><span class="n">scNames</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">do_fuzzy_match</span><span class="p">:</span>
       <span class="n">best_match</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">best_match</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">scNames</span><span class="p">,</span>
        <span class="s1">&#39;best_match_only&#39;</span><span class="p">:</span> <span class="n">best_match</span>
    <span class="p">}</span>
    
    <span class="c1">#encoded_payload = urllib.urlencode(payload)</span>
    <span class="c1">#response = requests.get(api_url, params=encoded_payload, headers=headers)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>  
    <span class="c1">#jsonPayload = json.dumps(payload)</span>
    <span class="c1">#response = requests.post(api_url, data=jsonPayload,headers=headers)     </span>
    <span class="nb">print</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
    <span class="n">resolvedNamesList</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="n">data_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">requests</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>        
        <span class="n">rsnames_list</span> <span class="o">=</span> <span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">parameters_list</span> <span class="o">=</span> <span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>   
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">rsnames_list</span><span class="p">:</span>
            <span class="n">mult_matches_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">input_name</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;supplied_name_string&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;results&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
               <span class="k">continue</span>
            <span class="n">match_list</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">match_list</span><span class="p">:</span>
                <span class="n">namesList</span> <span class="o">=</span> <span class="p">{}</span>
                
                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">0.75</span><span class="p">:</span>
                   <span class="n">rsname</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s1">&#39;canonical_form&#39;</span><span class="p">]</span>
       	           <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;search_string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_name</span>
            	   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;matched_name&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">rsname</span>
            	   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;match_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Exact&#39;</span> <span class="k">if</span> <span class="n">match</span><span class="p">[</span><span class="s1">&#39;match_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Fuzzy&#39;</span>
                   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;data_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s1">&#39;data_source_title&#39;</span><span class="p">]</span>      
            	   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;synonyms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;match_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>  
            	   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;taxon_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s1">&#39;taxon_id&#39;</span><span class="p">]</span>		
                   <span class="n">mult_matches_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">namesList</span><span class="p">)</span>	
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">multi_match</span><span class="p">)</span> <span class="ow">and</span> <span class="n">do_fuzzy_match</span><span class="p">:</span> 
                   <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">do_fuzzy_match</span> <span class="ow">and</span> <span class="n">match</span><span class="p">[</span><span class="s1">&#39;match_type&#39;</span><span class="p">]</span> <span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
               <span class="k">continue</span>
            <span class="n">resolvedNamesList</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;input_name&#39;</span><span class="p">:</span> <span class="n">input_name</span><span class="p">,</span> <span class="s1">&#39;matched_results&#39;</span><span class="p">:</span> <span class="n">mult_matches_list</span><span class="p">})</span>
		
        <span class="n">statuscode</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Success&quot;</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">data_json</span><span class="p">:</span>
           <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;GNR Error: &quot;</span><span class="o">+</span><span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error: Response error while resolving names with GNR&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">data_json</span><span class="p">:</span>
           <span class="n">statuscode</span> <span class="o">=</span> <span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
        
        <span class="n">statuscode</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>   

    <span class="nb">print</span> <span class="n">resolvedNamesList</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">:</span> <span class="n">resolvedNamesList</span><span class="p">,</span> <span class="s1">&#39;gnr_parameters&#39;</span><span class="p">:</span> <span class="n">parameters_list</span><span class="p">,</span> <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">statuscode</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
        
<span class="c1">#----------------------------------------------    </span>

<span class="c1">#Process Scientific Names List for GNR</span>
<span class="k">def</span> <span class="nf">make_api_friendly_list</span><span class="p">(</span><span class="n">scNamesList</span><span class="p">):</span>
    <span class="c1">#process list    </span>
    <span class="n">ListSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scNamesList</span><span class="p">)</span>    
    
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">TobeResolvedNames</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="k">for</span> <span class="n">str_element</span> <span class="ow">in</span> <span class="n">scNamesList</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span><span class="p">(</span><span class="n">count</span> <span class="o">!=</span> <span class="n">ListSize</span><span class="p">):</span>
            <span class="n">str_element</span> <span class="o">+=</span> <span class="s1">&#39;||&#39;</span> 
        <span class="n">TobeResolvedNames</span> <span class="o">+=</span> <span class="n">str_element</span>
    
    <span class="c1">#print &quot;List size:&quot;+ str(ListSize)    </span>
    <span class="k">return</span> <span class="n">TobeResolvedNames</span>
                
<span class="c1">#-----------------------------------------------------</span>
<span class="c1">#Process Scientific Names List for iPlant</span>
<span class="k">def</span> <span class="nf">make_iplant_api_friendly_list</span><span class="p">(</span><span class="n">scNamesList</span><span class="p">):</span>
    <span class="c1">#process list for iPlant api    </span>
    <span class="n">ListSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scNamesList</span><span class="p">)</span>    
    
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">TobeResolvedNames</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="k">for</span> <span class="n">str_element</span> <span class="ow">in</span> <span class="n">scNamesList</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span><span class="p">(</span><span class="n">count</span> <span class="o">!=</span> <span class="n">ListSize</span><span class="p">):</span>
            <span class="n">str_element</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span> 
        <span class="n">TobeResolvedNames</span> <span class="o">+=</span> <span class="n">str_element</span>
    
    <span class="c1">#print &quot;List size:&quot;+ str(ListSize)    </span>
    <span class="k">return</span> <span class="n">TobeResolvedNames</span>


<span class="c1">#~~~~~~~~~~~~~~~~~~~~ (iplantcollaborative-TNRS)~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="c1">#resolve scientific names using iplantcollaborative</span>
<span class="k">def</span> <span class="nf">resolve_sn_iplant</span><span class="p">(</span><span class="n">scNames</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Source: http://tnrs.iplantcollaborative.org/api.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iplant_api_url</span> <span class="o">=</span> <span class="s2">&quot;http://tnrs.iplantc.org/tnrsm-svc/matchNames&quot;</span>

    <span class="k">if</span> <span class="n">do_fuzzy_match</span><span class="p">:</span>
       <span class="n">match_type</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>  <span class="c1">#&#39;all&#39; retrieves all matches</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">match_type</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span> <span class="c1">#&#39;best&#39; retrieves only the single best match for each name submitted</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">scNames</span><span class="p">,</span>
        <span class="s1">&#39;retrieve&#39;</span><span class="p">:</span> <span class="n">match_type</span>
    <span class="p">}</span>
    
    <span class="n">encoded_payload</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">iplant_api_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">encoded_payload</span><span class="p">)</span> 
    <span class="c1">#print response.text</span>
    
    <span class="n">resolvedNamesList</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="n">data_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">requests</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>  
        <span class="n">rsnames_list</span> <span class="o">=</span> <span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>
        
        <span class="c1">#get the group numbers</span>
        <span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">rsnames_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">group_list</span><span class="p">:</span> 
               <span class="n">group_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]))</span>

        <span class="c1">#find the multiple matches of the same item </span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_list</span><span class="p">:</span>
            <span class="n">match_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rsn</span> <span class="ow">in</span> <span class="n">rsnames_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">rsn</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">group</span><span class="p">:</span>
                   <span class="n">match_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rsn</span><span class="p">)</span>
                
            <span class="n">mult_matches_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">matched_element</span> <span class="ow">in</span> <span class="n">match_list</span><span class="p">:</span>
                <span class="n">namesList</span> <span class="o">=</span> <span class="p">{}</span> 
                <span class="n">input_name</span> <span class="o">=</span> <span class="n">matched_element</span><span class="p">[</span><span class="s1">&#39;nameSubmitted&#39;</span><span class="p">]</span>
                <span class="n">match_score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">matched_element</span><span class="p">[</span><span class="s1">&#39;scientificScore&#39;</span><span class="p">])</span>
                <span class="n">taxon_url</span> <span class="o">=</span> <span class="n">matched_element</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">match_score</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>
                   <span class="n">rs_name</span> <span class="o">=</span> <span class="n">matched_element</span><span class="p">[</span><span class="s1">&#39;nameScientific&#39;</span><span class="p">]</span>
       	           <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;search_string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_name</span>
                   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;matched_name&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">rs_name</span>
                   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;match_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Exact&#39;</span> <span class="k">if</span> <span class="n">match_score</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Fuzzy&#39;</span>
                   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;data_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tropicos - Missouri Botanical Garden&quot;</span>      
                   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;synonyms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;match_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_score</span>  
                   <span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;taxon_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">taxon_url</span><span class="p">[</span><span class="n">taxon_url</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">taxon_url</span><span class="p">)]</span>		
                   <span class="n">mult_matches_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">namesList</span><span class="p">)</span>	
               
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">multi_match</span><span class="p">)</span> <span class="ow">and</span> <span class="n">do_fuzzy_match</span><span class="p">:</span>
                   <span class="k">break</span>
               
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">do_fuzzy_match</span><span class="p">)</span> <span class="ow">and</span> <span class="n">match_score</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
               <span class="k">continue</span>
 
            <span class="n">resolvedNamesList</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;input_name&#39;</span><span class="p">:</span> <span class="n">input_name</span><span class="p">,</span> <span class="s1">&#39;matched_results&#39;</span><span class="p">:</span> <span class="n">mult_matches_list</span><span class="p">})</span>		

        <span class="n">statuscode</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Success&quot;</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">data_json</span><span class="p">:</span>
           <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;iPlantcollaborative Error: &quot;</span><span class="o">+</span><span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
           <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error: Response error while resolving names with iPlantcollaborative&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">data_json</span><span class="p">:</span>
           <span class="n">statuscode</span> <span class="o">=</span> <span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
        
        <span class="n">statuscode</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>   

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">:</span> <span class="n">resolvedNamesList</span><span class="p">,</span> <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">statuscode</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
        
<span class="c1">#----------------------------------------------    </span>
                

<span class="c1">#~~~~~~~~~~~~~~~~~~~~ (OpenTreeofLife-TNRS)~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="k">def</span> <span class="nf">resolve_sn_ot</span><span class="p">(</span><span class="n">scNames</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">):</span>
    <span class="n">opentree_api_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.opentreeoflife.org/v2/tnrs/match_names&#39;</span>
  
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">scNames</span><span class="p">,</span>
 		<span class="s1">&#39;do_approximate_matching&#39;</span><span class="p">:</span> <span class="n">do_fuzzy_match</span>
    <span class="p">}</span>
    <span class="n">jsonPayload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span> 
       <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">opentree_api_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">jsonPayload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
       <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">:</span> <span class="p">[],</span><span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;Connection error with OpenTreeofLife API&quot;</span><span class="p">}</span>

    <span class="c1">#----------------------------------------------</span>
    <span class="c1">#response = requests.post(opentree_api_url, data=jsonPayload, headers=headers)</span>
    
    <span class="n">data_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="n">resolvedNamesList</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">requests</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>    
        <span class="n">rsnames_list</span> <span class="o">=</span> <span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> 
        <span class="n">resolvedNamesList</span> <span class="o">=</span> <span class="n">get_resolved_names</span><span class="p">(</span><span class="n">rsnames_list</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">)</span>
        <span class="n">statuscode</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Success&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">data_json</span><span class="p">:</span>
           <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;OToL TNRS Error: &quot;</span><span class="o">+</span><span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error: Response error while resolving names with OToL TNRS&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">data_json</span><span class="p">:</span>
           <span class="n">statuscode</span> <span class="o">=</span> <span class="n">data_json</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
        
        <span class="n">statuscode</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>   
        
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">:</span> <span class="n">resolvedNamesList</span><span class="p">,</span> <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">statuscode</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
 
<span class="c1">#-------------------------------------------</span>
<span class="k">def</span> <span class="nf">get_resolved_names</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">):</span>
 	<span class="n">resolvedNameslist</span> <span class="o">=</span> <span class="p">[]</span>
 	
 	<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
 		<span class="n">input_name</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
 		<span class="n">match_list</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;matches&#39;</span><span class="p">]</span>
 		<span class="n">mult_matches_list</span> <span class="o">=</span> <span class="p">[]</span>
 		<span class="k">for</span> <span class="n">match_result</span> <span class="ow">in</span> <span class="n">match_list</span><span class="p">:</span>
 			<span class="n">namesList</span> <span class="o">=</span> <span class="p">{}</span>
 			<span class="n">search_str</span> <span class="o">=</span> <span class="n">match_result</span><span class="p">[</span><span class="s1">&#39;search_string&#39;</span><span class="p">]</span>
 			<span class="n">match_str</span> <span class="o">=</span> <span class="n">match_result</span><span class="p">[</span><span class="s1">&#39;matched_name&#39;</span><span class="p">]</span>
 			<span class="n">match_type</span> <span class="o">=</span> <span class="n">match_result</span><span class="p">[</span><span class="s1">&#39;is_approximate_match&#39;</span><span class="p">]</span>
 			<span class="n">match_score</span> <span class="o">=</span> <span class="n">match_result</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
 			<span class="n">ott_id</span> <span class="o">=</span> <span class="n">match_result</span><span class="p">[</span><span class="s1">&#39;ot:ottId&#39;</span><span class="p">]</span>
 			<span class="n">synonyms</span> <span class="o">=</span> <span class="n">match_result</span><span class="p">[</span><span class="s1">&#39;synonyms&#39;</span><span class="p">]</span>
 			<span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">match_score</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.75</span><span class="p">:</span>	     	
 				<span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;matched_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_str</span>
 				<span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;search_string&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_str</span>	 
 				<span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;match_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Exact&#39;</span> <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">match_type</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;Fuzzy&#39;</span>
 				<span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;match_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_score</span>          
 				<span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;synonyms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">synonyms</span>
 				<span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;taxon_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ott_id</span>
 				<span class="n">namesList</span><span class="p">[</span><span class="s1">&#39;data_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Open Tree of Life Reference Taxonomy&quot;</span>
 				<span class="n">mult_matches_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">namesList</span><span class="p">)</span>	
 			<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">multi_match</span><span class="p">)</span> <span class="ow">and</span> <span class="n">do_fuzzy_match</span><span class="p">:</span> 
 				<span class="k">break</span>

 		<span class="n">resolvedNameslist</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;input_name&#39;</span><span class="p">:</span> <span class="n">input_name</span><span class="p">,</span> <span class="s1">&#39;matched_results&#39;</span><span class="p">:</span> <span class="n">mult_matches_list</span><span class="p">})</span>

 	<span class="c1">#print len(resolvedNameslist)</span>
 	<span class="k">return</span> <span class="n">resolvedNameslist</span>

<span class="c1">#---------------------------------</span>
<span class="k">def</span> <span class="nf">create_sublists</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">size</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),</span> <span class="n">size</span><span class="p">)]</span>

<span class="c1">#--------------------------------------------</span>
<div class="viewcode-block" id="resolve_names_OT"><a class="viewcode-back" href="../../phylotastic_services.html#phylotastic_services.resolve_names.resolve_names_OT">[docs]</a><span class="k">def</span> <span class="nf">resolve_names_OT</span><span class="p">(</span><span class="n">inputNamesList</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multi_match</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Resolves scientific names using Open Tree of Life TNRS</span>
<span class="sd">    </span>
<span class="sd">	For example:</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; import phylotastic_services</span>
<span class="sd">	&gt;&gt;&gt; result = phylotastic_services.resolve_names_OT([&quot;Formica polyctena&quot;, &quot;Tetramorium caespitum&quot;,&quot;Carebara diversa&quot;])</span>
<span class="sd">	&gt;&gt;&gt; print result</span>
<span class="sd">	{&quot;status_code&quot;: 200, &quot;message&quot;: &quot;Success&quot;, &quot;meta_data&quot;: {&quot;execution_time&quot;: 0.32, &quot;creation_time&quot;: &quot;2018-05-23T19:11:42.801871&quot;, &quot;source_urls&quot;: [&quot;https://github.com/OpenTreeOfLife/opentree/wiki/Open-Tree-of-Life-APIs#tnrs&quot;]}, &quot;total_names&quot;: 3, &quot;resolvedNames&quot;: [{&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;Open Tree of Life Reference Taxonomy&quot;, &quot;match_type&quot;: &quot;Exact&quot;, &quot;match_score&quot;: 1.0, &quot;matched_name&quot;: &quot;Tetramorium caespitum&quot;, &quot;search_string&quot;: &quot;tetramorium caespitum&quot;, &quot;synonyms&quot;: [&quot;Tetramorium caespitum&quot;], &quot;taxon_id&quot;: 214421}], &quot;input_name&quot;: &quot;Tetramorium caespitum&quot;}, {&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;Open Tree of Life Reference Taxonomy&quot;, &quot;match_type&quot;: &quot;Exact&quot;, &quot;match_score&quot;: 1.0, &quot;matched_name&quot;: &quot;Formica polyctena&quot;, &quot;search_string&quot;: &quot;formica polyctena&quot;, &quot;synonyms&quot;: [&quot;Formica polyctenum&quot;, &quot;Formica polyctena&quot;], &quot;taxon_id&quot;: 815730}], &quot;input_name&quot;: &quot;Formica polyctena&quot;}, {&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;Open Tree of Life Reference Taxonomy&quot;, &quot;match_type&quot;: &quot;Exact&quot;, &quot;match_score&quot;: 1.0, &quot;matched_name&quot;: &quot;Carebara diversa&quot;, &quot;search_string&quot;: &quot;carebara diversa&quot;, &quot;synonyms&quot;: [&quot;Pheidologeton diversus&quot;, &quot;Carebara diversus&quot;, &quot;Carebara diversa&quot;], &quot;taxon_id&quot;: 842045}], &quot;input_name&quot;: &quot;Carebara diversa&quot;}]}</span>

<span class="sd">    :param inputNamesList: A list of scientific names to be resolved. </span>
<span class="sd">    :type inputNamesList: A list of str. </span>
<span class="sd">    :param do_fuzzy_match: A boolean value to specify whether to perform approximate string (a.k.a. &quot;fuzzy&quot;) matching. By default, it is ``False``. To turn on &quot;fuzzy&quot; matching ``True`` must be used.</span>
<span class="sd">    :type do_fuzzy_match: boolean.</span>
<span class="sd">    :param multi_match: A boolean value to specify whether to return multiple match results when fuzzy matching is turned on. By default it is ``False``. If fuzzy matching is turned on and multiple_match is enabled (``True``), then it will return results of matches with score more than 0.75.</span>
<span class="sd">    :type multi_match: boolean.</span>
<span class="sd">    </span>
<span class="sd">    :returns: A json formatted string -- with a list of dict objects as the value of the ``resolvedNames`` property. </span>

<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">list_size</span> <span class="o">=</span> <span class="mi">250</span>
    <span class="n">final_result</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Success&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputNamesList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">list_size</span><span class="p">:</span>
    	<span class="n">sublists</span> <span class="o">=</span> <span class="n">create_sublists</span><span class="p">(</span><span class="n">inputNamesList</span><span class="p">,</span> <span class="n">list_size</span><span class="p">)</span>
    	<span class="k">for</span> <span class="n">sublst</span> <span class="ow">in</span> <span class="n">sublists</span><span class="p">:</span>
    		<span class="n">resolvedResult</span> <span class="o">=</span> <span class="n">resolve_sn_ot</span><span class="p">(</span><span class="n">sublst</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">)</span>
    		<span class="n">resolvedNameslst</span> <span class="o">=</span> <span class="n">resolvedResult</span><span class="p">[</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">]</span>
    		<span class="k">if</span> <span class="n">resolvedResult</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
    			<span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">resolvedResult</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">],</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">resolvedResult</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]}</span>
    		<span class="n">final_result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">resolvedNameslst</span><span class="p">)</span>  
    <span class="k">else</span><span class="p">:</span>
    	<span class="n">resolvedResult</span> <span class="o">=</span> <span class="n">resolve_sn_ot</span><span class="p">(</span><span class="n">inputNamesList</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">)</span>
    	<span class="n">final_result</span> <span class="o">=</span> <span class="n">resolvedResult</span><span class="p">[</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">]</span>
    	<span class="n">status_code</span> <span class="o">=</span> <span class="n">resolvedResult</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span>
    	<span class="n">message</span> <span class="o">=</span> <span class="n">resolvedResult</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>

    <span class="n">result_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_result</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result_len</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Could not resolve any name&quot;</span> 

    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="c1">#service_documentation = &quot;https://github.com/phylotastic/phylo_services_docs/blob/master/ServiceDescription/PhyloServicesDescription.md#web-service-3&quot;</span>
    <span class="n">execution_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:4.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end_time</span><span class="o">-</span><span class="n">start_time</span><span class="p">))</span>
    <span class="c1">#service result creation time</span>
    <span class="n">creation_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">meta_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;creation_time&#39;</span><span class="p">:</span> <span class="n">creation_time</span><span class="p">,</span> <span class="s1">&#39;execution_time&#39;</span><span class="p">:</span> <span class="n">execution_time</span><span class="p">,</span> <span class="s1">&#39;source_urls&#39;</span><span class="p">:[</span><span class="s2">&quot;https://github.com/OpenTreeOfLife/opentree/wiki/Open-Tree-of-Life-APIs#tnrs&quot;</span><span class="p">]</span> <span class="p">}</span>
<span class="c1">#&quot;service_documentation&quot;: service_documentation}</span>

    <span class="c1">#return {&#39;resolvedNames&#39;: final_result, &#39;total_names&#39;: result_len, &#39;status_code&#39;: status_code, &#39;input_names&#39;: inputNamesList , &#39;message&#39;: message, &#39;meta_data&#39;: meta_data}</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">:</span> <span class="n">final_result</span><span class="p">,</span> <span class="s1">&#39;total_names&#39;</span><span class="p">:</span> <span class="n">result_len</span><span class="p">,</span> <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">status_code</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span> <span class="s1">&#39;meta_data&#39;</span><span class="p">:</span> <span class="n">meta_data</span><span class="p">})</span></div>

<span class="c1">#-----------------------------------------------------------</span>
<div class="viewcode-block" id="resolve_names_GNR"><a class="viewcode-back" href="../../phylotastic_services.html#phylotastic_services.resolve_names.resolve_names_GNR">[docs]</a><span class="k">def</span> <span class="nf">resolve_names_GNR</span><span class="p">(</span><span class="n">inputNamesList</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multi_match</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Resolves scientific names using Global Names Resolver</span>
<span class="sd">    </span>
<span class="sd">	For example:</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; import phylotastic_services</span>
<span class="sd">	&gt;&gt;&gt; result = phylotastic_services.resolve_names_GNR([&quot;Formica exsectoides&quot;,&quot;Formica pecefica&quot;, &quot;Setophaga angilae&quot;], True)</span>
<span class="sd">	&gt;&gt;&gt; print result</span>
<span class="sd">	{&quot;resolvedNames&quot;: [{&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;NCBI&quot;, &quot;match_type&quot;: &quot;Exact&quot;, &quot;match_score&quot;: 0.988, &quot;matched_name&quot;: &quot;Formica exsectoides&quot;, &quot;search_string&quot;: &quot;Formica exsectoides&quot;, &quot;synonyms&quot;: [], &quot;taxon_id&quot;: &quot;609781&quot;}], &quot;input_name&quot;: &quot;Formica exsectoides&quot;}, {&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;Catalogue of Life&quot;, &quot;match_type&quot;: &quot;Fuzzy&quot;, &quot;match_score&quot;: 0.75, &quot;matched_name&quot;: &quot;Formica pacifica&quot;, &quot;search_string&quot;: &quot;Formica pecefica&quot;, &quot;synonyms&quot;: [], &quot;taxon_id&quot;: &quot;2f41fe085d8ff5d5bb75e520d0a692de&quot;}], &quot;input_name&quot;: &quot;Formica pecefica&quot;}, {&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;Catalogue of Life&quot;, &quot;match_type&quot;: &quot;Fuzzy&quot;, &quot;match_score&quot;: 0.75, &quot;matched_name&quot;: &quot;Setophaga angelae&quot;, &quot;search_string&quot;: &quot;Setophaga angilae&quot;, &quot;synonyms&quot;: [], &quot;taxon_id&quot;: &quot;70b0dd5edac3927169524396759bbbfa&quot;}], &quot;input_name&quot;: &quot;Setophaga angilae&quot;}], &quot;status_code&quot;: 200, &quot;meta_data&quot;: {&quot;execution_time&quot;: 0.52, &quot;creation_time&quot;: &quot;2018-05-23T19:14:16.947898&quot;, &quot;source_urls&quot;: [&quot;http://resolver.globalnames.org/&quot;]}, &quot;total_names&quot;: 3, &quot;gnr_parameters&quot;: {&quot;with_vernaculars&quot;: false, &quot;best_match_only&quot;: false, &quot;data_sources&quot;: [], &quot;with_context&quot;: false, &quot;header_only&quot;: false, &quot;resolve_once&quot;: false, &quot;preferred_data_sources&quot;: [], &quot;with_canonical_ranks&quot;: false}, &quot;message&quot;: &quot;Success&quot;}</span>

<span class="sd">    :param inputNamesList: A list of scientific names to be resolved. </span>
<span class="sd">    :type inputNamesList: A list of str. </span>
<span class="sd">    :param do_fuzzy_match: A boolean value to specify whether to perform approximate string (a.k.a. &quot;fuzzy&quot;) matching. By default, it is ``False``. To turn on &quot;fuzzy&quot; matching ``True`` must be used.</span>
<span class="sd">    :type do_fuzzy_match: boolean.</span>
<span class="sd">    :param multi_match: A boolean value to specify whether to return multiple match results when fuzzy matching is turned on. By default it is ``False``. If fuzzy matching is turned on and multiple_match is enabled (``True``), then it will return results of matches with score more than 0.75.</span>
<span class="sd">    :type multi_match: boolean.</span>

<span class="sd">    :returns: A json formatted string -- with a list of dict objects as the value of the ``resolvedNames`` property. </span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">api_friendly_list</span> <span class="o">=</span> <span class="n">make_api_friendly_list</span><span class="p">(</span><span class="n">inputNamesList</span><span class="p">)</span>	
    <span class="n">final_result</span> <span class="o">=</span> <span class="n">resolve_sn_gnr</span><span class="p">(</span><span class="n">api_friendly_list</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">)</span>    
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">execution_time</span> <span class="o">=</span> <span class="n">end_time</span><span class="o">-</span><span class="n">start_time</span>

    <span class="n">result_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">result_len</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Could not resolve any name&quot;</span>

    <span class="c1">#service_documentation = &quot;https://github.com/phylotastic/phylo_services_docs/blob/master/ServiceDescription/PhyloServicesDescription.md#web-service-4&quot;</span>
    <span class="c1">#service result creation time</span>
    <span class="n">creation_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">meta_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;creation_time&#39;</span><span class="p">:</span> <span class="n">creation_time</span><span class="p">,</span> <span class="s1">&#39;execution_time&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:4.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">execution_time</span><span class="p">)),</span> <span class="s1">&#39;source_urls&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;http://resolver.globalnames.org/&quot;</span><span class="p">]</span> <span class="p">}</span>
<span class="c1">#&quot;service_documentation&quot;: service_documentation}</span>
    <span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;meta_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span>
    <span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;total_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_len</span>
    <span class="c1">#final_result[&#39;input_names&#39;] = inputNamesList</span>
    
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">final_result</span><span class="p">)</span></div>

<span class="c1">#------------------------------------------------------</span>
<div class="viewcode-block" id="resolve_names_iPlant"><a class="viewcode-back" href="../../phylotastic_services.html#phylotastic_services.resolve_names.resolve_names_iPlant">[docs]</a><span class="k">def</span> <span class="nf">resolve_names_iPlant</span><span class="p">(</span><span class="n">inputNamesList</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multi_match</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Resolves scientific names using iplantCollaborative TNRS</span>
<span class="sd">    </span>
<span class="sd">	For example:</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; import phylotastic_services</span>
<span class="sd">	&gt;&gt;&gt; result = phylotastic_services.resolve_names_iPlant([&quot;Acanthophyllum albidum&quot;,&quot;Acanthostachys pitcairnioides&quot;,&quot;Acanthostyles buniifolius&quot;], True, False)</span>
<span class="sd">	&gt;&gt;&gt; print result</span>
<span class="sd">	{&quot;status_code&quot;: 200, &quot;message&quot;: &quot;Success&quot;, &quot;meta_data&quot;: {&quot;execution_time&quot;: 0.46, &quot;creation_time&quot;: &quot;2018-05-23T19:05:45.652250&quot;, &quot;source_urls&quot;: [&quot;http://tnrs.iplantcollaborative.org&quot;]}, &quot;total_names&quot;: 3, &quot;resolvedNames&quot;: [{&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;Tropicos - Missouri Botanical Garden&quot;, &quot;match_type&quot;: &quot;Exact&quot;, &quot;match_score&quot;: 1.0, &quot;matched_name&quot;: &quot;Acanthophyllum albidum&quot;, &quot;search_string&quot;: &quot;Acanthophyllum albidum&quot;, &quot;synonyms&quot;: [], &quot;taxon_id&quot;: &quot;6302165&quot;}], &quot;input_name&quot;: &quot;Acanthophyllum albidum&quot;}, {&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;Tropicos - Missouri Botanical Garden&quot;, &quot;match_type&quot;: &quot;Exact&quot;, &quot;match_score&quot;: 1.0, &quot;matched_name&quot;: &quot;Acanthostachys pitcairnioides&quot;, &quot;search_string&quot;: &quot;Acanthostachys pitcairnioides&quot;, &quot;synonyms&quot;: [], &quot;taxon_id&quot;: &quot;50038733&quot;}], &quot;input_name&quot;: &quot;Acanthostachys pitcairnioides&quot;}, {&quot;matched_results&quot;: [{&quot;data_source&quot;: &quot;Tropicos - Missouri Botanical Garden&quot;, &quot;match_type&quot;: &quot;Exact&quot;, &quot;match_score&quot;: 1.0, &quot;matched_name&quot;: &quot;Acanthostyles buniifolius&quot;, &quot;search_string&quot;: &quot;Acanthostyles buniifolius&quot;, &quot;synonyms&quot;: [], &quot;taxon_id&quot;: &quot;2712077&quot;}], &quot;input_name&quot;: &quot;Acanthostyles buniifolius&quot;}]}</span>

<span class="sd">    :param inputNamesList: A list of scientific names to be resolved. </span>
<span class="sd">    :type inputNamesList: A list of str. </span>
<span class="sd">    :param do_fuzzy_match: A boolean value to specify whether to perform approximate string (a.k.a. &quot;fuzzy&quot;) matching. By default, it is ``False``. To turn on &quot;fuzzy&quot; matching ``True`` must be used.</span>
<span class="sd">    :type do_fuzzy_match: boolean.</span>
<span class="sd">    :param multi_match: A boolean value to specify whether to return multiple match results when fuzzy matching is turned on. By default it is false. If fuzzy matching is turned on and multiple_match is enabled (``True``), then the service will return results of matches with score more than 0.50.</span>
<span class="sd">    :type multi_match: boolean.</span>

<span class="sd">    :returns: A json formatted string -- with a list of dict objects as the value of the ``resolvedNames`` property. </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">api_friendly_list</span> <span class="o">=</span> <span class="n">make_iplant_api_friendly_list</span><span class="p">(</span><span class="n">inputNamesList</span><span class="p">)</span>	
    <span class="n">final_result</span> <span class="o">=</span> <span class="n">resolve_sn_iplant</span><span class="p">(</span><span class="n">api_friendly_list</span><span class="p">,</span> <span class="n">do_fuzzy_match</span><span class="p">,</span> <span class="n">multi_match</span><span class="p">)</span>    
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">execution_time</span> <span class="o">=</span> <span class="n">end_time</span><span class="o">-</span><span class="n">start_time</span>

    <span class="n">result_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;resolvedNames&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">result_len</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Could not resolve any name&quot;</span>

    <span class="c1">#service_documentation = &quot;&quot;</span>
    <span class="c1">#service result creation time</span>
    <span class="n">creation_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">meta_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;creation_time&#39;</span><span class="p">:</span> <span class="n">creation_time</span><span class="p">,</span> <span class="s1">&#39;execution_time&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:4.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">execution_time</span><span class="p">)),</span> <span class="s1">&#39;source_urls&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;http://tnrs.iplantcollaborative.org&quot;</span><span class="p">]</span> <span class="p">}</span>
<span class="c1">#&quot;service_documentation&quot;: service_documentation}</span>
    <span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;meta_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span>
    <span class="n">final_result</span><span class="p">[</span><span class="s1">&#39;total_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_len</span>
    <span class="c1">#final_result[&#39;input_names&#39;] = inputNamesList</span>
    
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">final_result</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Abu Saleh Md Tayeen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>